limit_req_zone $request_uri zone=stage_1:10m rate=5r/s;
limit_req_zone $request_uri zone=stage_2:10m rate=1r/s;

server {
    listen 80;
	
	set $zone stage_1;
	if ($http_Authorization = "abc") {
		set $zone stage_2;
	}

    location /by-uri/stage {
		limit_req zone=stage_1 nodelay;
		try_files $uri /index.html;
    }

    location /by-uri/stage_2 {
        limit_req zone=stage_2 nodelay;
        try_files $uri /index.html;
    }
}

http {
	limit_req_zone $limit_bots zone=bots:10m rate=1r/m;
	server {
		location / {
		set $bot ‘’;
		if ($http_user_agent ~* (google|bing|yandex|msnbot) ) {
			set $limit_bots $binary_remote_addr;
		}
		limit_req zone=bots burst=5 nodelay;
		}
	}
}