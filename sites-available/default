limit_req_zone $request_uri zone=stage_1:10m rate=5r/s;
limit_req_zone $request_uri zone=stage_2:10m rate=1r/s;

log_format  custom '$remote_addr - $remote_user [$time_local] '
                         	     '"$request" $status $body_bytes_sent '
                      		     '"$http_referer" "$http_user_agent" '
                     		     '"$http_x_forwarded_for" $request_id '
                   		     '$geoip_country_name $geoip_country_code '
                  		     '$geoip_region_name $geoip_city ';

server {
    listen 80;

    location /by-uri/stage_1 {
        limit_req zone=stage_1 burst=5 nodelay;
        try_files $uri /index.html;

		access_log /var/log/nginx/access.log custom;
		error_log /var/log/nginx/error.log;
    }

    location /by-uri/stage_2 {
        limit_req zone=stage_2 nodelay;
		echo "args: $args"
        try_files $uri /index.html;
    }
}